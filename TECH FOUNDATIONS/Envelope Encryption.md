### **Understanding Envelope Encryption with KMS**

**1. Key Management Service (KMS):**
- KMS is a service that securely manages encryption keys. It handles **Key Encryption Keys (KEKs)**, which are used to encrypt other keys.

**2. Data Encryption Key (DEK):**
- DEKs are generated by KMS to encrypt data. 
- **Two versions of DEK:**
  - **Plaintext DEK:** Used temporarily to encrypt data and then discarded.
  - **Encrypted DEK (Wrapped Key):** The DEK is encrypted using the KEK and stored with the data it protects.

**3. Why Envelope Encryption?**
- **Envelope encryption** uses both DEKs and KEKs to secure data. Itâ€™s like wrapping the DEK (which is used to encrypt the actual data) with another layer of security using the KEK.
- This method ensures that each piece of data has a unique DEK, which is encrypted and stored safely.

**4. How It Works:**
- **Encryption:**
  1. KMS generates a DEK.
  2. The DEK encrypts the plaintext data, turning it into ciphertext.
  3. The DEK is then encrypted by a KEK (managed by KMS) and stored with the ciphertext.
  4. The original DEK is discarded after use, ensuring it's not stored in plaintext anywhere.
  
- **Decryption:**
  1. A request is made to KMS to decrypt the data.
  2. KMS unwraps (decrypts) the stored, encrypted DEK using the KEK.
  3. The DEK is used to decrypt the ciphertext back into plaintext data.
  4. After decryption, the DEK is discarded again.

**5. Key Points:**
- **KEKs** can be either symmetric or asymmetric keys, depending on the configuration.
- **DEKs** are always symmetric because they are fast for encryption/decryption processes.
- KMS ensures that even though the admin can manage the storage of encrypted data, they cannot decrypt it without KMS involvement.
